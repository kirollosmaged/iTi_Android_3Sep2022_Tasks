

CREATE COMPUTE MODULE CheckBalanceFlow_Compute
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
		 CALL CopyMessageHeaders();
		 CREATE LASTCHILD OF OutputRoot DOMAIN ('JSON');
		 CREATE LASTCHILD OF OutputRoot.JSON NAME 'Data';
		 CREATE LASTCHILD OF OutputRoot.JSON.Data NAME 'MsgRsp';
		 DECLARE outRef REFERENCE TO OutputRoot.JSON.Data.MsgRsp;
		 DECLARE name CHARACTER CAST(InputRoot.JSON.Data.name AS CHARACTER);
		 IF name = 'AHMED' THEN
		 	SET outRef.Balance='100';
		 ELSE
		 	SET outRef.ErrorMessage='the '||name||' customer does not exist';
		 END IF;
		-- CALL CopyEntireMessage();
		RETURN TRUE;
	END;
	


	CREATE PROCEDURE CopyMessageHeaders() BEGIN
		DECLARE I INTEGER 1;
		DECLARE J INTEGER;
		SET J = CARDINALITY(InputRoot.*[]);
		WHILE I < J DO
			SET OutputRoot.*[I] = InputRoot.*[I];
			SET I = I + 1;
		END WHILE;
	END;

	CREATE PROCEDURE CopyEntireMessage() BEGIN
		SET OutputRoot = InputRoot;
	END;
END MODULE;
